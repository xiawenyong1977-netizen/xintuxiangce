<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>正在准备下载...</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            text-align: center;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="spinner"></div>
        <h2>正在准备下载芯图相册...</h2>
        <p>请稍候，正在为您准备最新版本</p>
    </div>

    <script>
        // 自动检测并下载最新文件
        async function downloadLatest() {
            // 尝试获取文件列表 - 使用fetch尝试访问dist目录
            let latestFile = null;
            
            // 方法1: 尝试访问一个已知存在的文件列表API（如果有的话）
            try {
                const response = await fetch('dist/files.json');
                if (response.ok) {
                    const files = await response.json();
                    latestFile = files.latest;
                }
            } catch (e) {
                console.log('files.json not found, trying alternative method');
            }
            
            // 方法2: 如果files.json不存在，尝试智能文件名检测
            if (!latestFile) {
                // 基于当前日期生成可能的文件名
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                
                // 生成可能的文件名（基于日期模式）- 便携版和安装版路径
                const possibleFiles = [
                    `pc/portable/xtxc${year}${month}${day}1200.zip`,  // 便携版今天12:00
                    `pc/setup/xtxc${year}${month}${day}1200-setup.exe`,  // 安装版今天12:00
                    `pc/portable/xtxc${year}${month}${day}1000.zip`,  // 便携版今天10:00
                    `pc/setup/xtxc${year}${month}${day}1000-setup.exe`,  // 安装版今天10:00
                    `pc/portable/xtxc${year}${month}${day}0800.zip`,  // 便携版今天08:00
                    `pc/setup/xtxc${year}${month}${day}0800-setup.exe`,  // 安装版今天08:00
                    `pc/portable/xtxc${year}${month}${day}1500.zip`,  // 便携版今天15:00
                    `pc/setup/xtxc${year}${month}${day}1500-setup.exe`,  // 安装版今天15:00
                    `pc/portable/xtxc${year}${month}${day}1400.zip`,  // 便携版今天14:00
                    `pc/setup/xtxc${year}${month}${day}1400-setup.exe`,  // 安装版今天14:00
                    `pc/portable/xtxc${year}${month}${day}1300.zip`,  // 便携版今天13:00
                    `pc/setup/xtxc${year}${month}${day}1300-setup.exe`,  // 安装版今天13:00
                ];
                
                // 尝试检测最新文件
                for (const filename of possibleFiles) {
                    try {
                        const response = await fetch(`dist/${filename}`, { method: 'HEAD' });
                        if (response.ok) {
                            latestFile = filename;
                            break;
                        }
                    } catch (e) {
                        continue;
                    }
                }
            }
            
            if (latestFile) {
                // 自动开始下载
                const link = document.createElement('a');
                link.href = `dist/${latestFile}`;
                link.download = latestFile;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // 显示成功信息
                const fileName = latestFile.split('/').pop(); // 只显示文件名
                document.querySelector('.container').innerHTML = `
                    <h2>✅ 下载已开始</h2>
                    <p>正在下载: ${fileName}</p>
                    <p>如果没有自动下载，请<a href="dist/${latestFile}" style="color: white; text-decoration: underline;">点击这里</a></p>
                `;
            } else {
                // 显示错误信息
                document.querySelector('.container').innerHTML = `
                    <h2>❌ 下载失败</h2>
                    <p>未找到可下载的文件</p>
                    <p><a href="index.html" style="color: white; text-decoration: underline;">返回首页</a></p>
                `;
            }
        }
        
        // 页面加载后自动执行
        window.addEventListener('load', downloadLatest);
    </script>
</body>
</html>
